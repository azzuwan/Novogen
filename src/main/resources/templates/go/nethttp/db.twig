package database

import (
	"log"

	"upper.io/db.v2"
	"upper.io/db.v2/{{project.database.type}}"
)

var settings = {{project.database.type}}.ConnectionURL{
	Database: `{{project.database.schema}}`,
	Host:     `{{project.database.host}}`,
	User:     `{{project.database.user}}`,
	Password: `{{project.database.password}}`,
}


{% for table in tables %}
type {{table.name|capitalize}} struct {
        {% for column in table.columns %}
        {{column.name|capitalize}}     {{column.type}}     `db:"{{column.name}}"`
        {% endfor%} {{System.lineSeparator()}}

}

{% endfor %}


func main() {
	sess, err := {{project.database.type}}.Open(settings)
	if err != nil {
		log.Fatal(err)
	}
	defer sess.Close()

	// Set this to true to enable the query logger which will print all SQL
	// statements to stdout.
	db.Conf.SetLogging(false)

	// Define a result set without passing a condition to Find(), this means we
	// want to match all the elements on the books table.
	res := sess.Collection("books").Find()

	// We can use this res object later in different queries, here we'll use it
	// to fetch all the books on our catalog in descending order.
	var books []Book
	if err := res.OrderBy("title DESC").All(&books); err != nil {
		log.Fatal(err)
	}

	// The books slice has been populated!
	log.Println("Books:")
	for _, book := range books {
		log.Printf("%q (ID: %d)\n", book.Title, book.ID)
	}
}
